<!DOCTYPE html><html lang="default" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>How Geth starts its server | Jiahao Luo</title><meta name="author" content="Michael(Jiahao) Luo"><meta name="copyright" content="Michael(Jiahao) Luo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server  When starting up, the Geth client begins by parsing the command line para">
<meta property="og:type" content="article">
<meta property="og:title" content="How Geth starts its server">
<meta property="og:url" content="https://www.blog-blockchain.xyz/geth/Geth-Unveiled-Ethereum-Startup/index.html">
<meta property="og:site_name" content="Jiahao Luo">
<meta property="og:description" content="交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server  When starting up, the Geth client begins by parsing the command line para">
<meta property="og:locale">
<meta property="og:image" content="https://www.blog-blockchain.xyz/images/geth.png">
<meta property="article:published_time" content="2023-09-13T15:02:10.000Z">
<meta property="article:modified_time" content="2024-11-15T14:30:54.923Z">
<meta property="article:author" content="Michael(Jiahao) Luo">
<meta property="article:tag" content="geth">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.blog-blockchain.xyz/images/geth.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How Geth starts its server",
  "url": "https://www.blog-blockchain.xyz/geth/Geth-Unveiled-Ethereum-Startup/",
  "image": "https://www.blog-blockchain.xyz/images/geth.png",
  "datePublished": "2023-09-13T15:02:10.000Z",
  "dateModified": "2024-11-15T14:30:54.923Z",
  "author": [
    {
      "@type": "Person",
      "name": "Michael(Jiahao) Luo",
      "url": "https://www.blog-blockchain.xyz/"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://www.blog-blockchain.xyz/geth/Geth-Unveiled-Ethereum-Startup/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/pwa/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/pwa/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/pwa/16.png"/><link rel="mask-icon" href="/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css?v=5.3.5"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?372b8854d18acf62880149b1e08e1901";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=QXcJQjXxTMeUwnWykFW2xw"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'QXcJQjXxTMeUwnWykFW2xw')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'QXcJQjXxTMeUwnWykFW2xw', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'How Geth starts its server',
  isHighlightShrink: false,
  isToc: false,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Jiahao Luo" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/site-avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">84</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">15</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archive</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Jiahao Luo</span></a><a class="nav-page-title" href="/"><span class="site-name">How Geth starts its server</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archive</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">How Geth starts its server</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-09-13T15:02:10.000Z" title="Created 2023-09-13 23:02:10">2023-09-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-11-15T14:30:54.923Z" title="Updated 2024-11-15 22:30:54">2024-11-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/geth/">geth</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>15mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><blockquote>
<ol class="series-items"><li><a href="/geth/tx-signature/" title="交易的签名">交易的签名</a></li><li><a href="/geth/understand-receipt/" title="理解收据receipt">理解收据receipt</a></li><li><a href="/geth/blocks/" title="理解区块">理解区块</a></li><li><a href="/geth/understand-tx/" title="理解交易">理解交易</a></li><li><a href="/geth/blockchain-core/" title="blockchain核心">blockchain核心</a></li><li><a href="/geth/forkId/" title="forkId 解读">forkId 解读</a></li><li><a href="/geth/bloom-filter/" title="布隆过滤器原理">布隆过滤器原理</a></li><li><a href="/geth/tx-pool/" title="交易池分析">交易池分析</a></li><li><a href="/geth/oracle-introduction/" title="oracle 原理和实现">oracle 原理和实现</a></li><li><a href="/geth/txlist/" title="TxList 解读">TxList 解读</a></li><li><a href="/geth/MPT-Tree/" title="MPT树">MPT树</a></li><li><a href="/geth/block-sync/" title="区块同步">区块同步</a></li><li><a href="/geth/introduction/" title="geth源码学习——介绍">geth源码学习——介绍</a></li><li><a href="/geth/Geth-Unveiled-Ethereum-Startup/" title="How Geth starts its server">How Geth starts its server</a></li></ol>
</blockquote>
<p>When starting up, the Geth client begins by parsing the command line parameters. This process kicks off with the <code>geth</code> function: <code>func geth(ctx *cli.Context) error </code> at <code>cmd/geth/main.go:326</code> where the <code>geth</code> prepares the metric if enabled. Subsequently, the <code>makeFullNode</code> function takes over. It reads the provided configuration file or command line flags. As a result, it returns two key components: <strong>the protocol stack</strong> and <strong>the backend API</strong>.</p>
<p>It’s worth noting the importance of the Backend API. It establishes a myriad of interfaces, facilitating interaction with nodes and handling external RPC call limits.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Backend interface provides the common API services (that are provided by</span></span><br><span class="line"><span class="comment">// both full and light clients) with access to necessary functions.</span></span><br><span class="line"><span class="keyword">type</span> Backend <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// General Ethereum API</span></span><br><span class="line">	SyncProgress() ethereum.SyncProgress</span><br><span class="line"></span><br><span class="line">	SuggestGasTipCap(ctx context.Context) (*big.Int, <span class="type">error</span>)</span><br><span class="line">	FeeHistory(ctx context.Context, blockCount <span class="type">uint64</span>, lastBlock rpc.BlockNumber, rewardPercentiles []<span class="type">float64</span>) (*big.Int, [][]*big.Int, []*big.Int, []<span class="type">float64</span>, <span class="type">error</span>)</span><br><span class="line">	ChainDb() ethdb.Database</span><br><span class="line">	AccountManager() *accounts.Manager</span><br><span class="line">	ExtRPCEnabled() <span class="type">bool</span></span><br><span class="line">	RPCGasCap() <span class="type">uint64</span>            <span class="comment">// global gas cap for eth_call over rpc: DoS protection</span></span><br><span class="line">	RPCEVMTimeout() time.Duration <span class="comment">// global timeout for eth_call over rpc: DoS protection</span></span><br><span class="line">	RPCTxFeeCap() <span class="type">float64</span>         <span class="comment">// global tx fee cap for all transaction related APIs</span></span><br><span class="line">	UnprotectedAllowed() <span class="type">bool</span>     <span class="comment">// allows only for EIP155 transactions.</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Blockchain API</span></span><br><span class="line">	SetHead(number <span class="type">uint64</span>)</span><br><span class="line">	HeaderByNumber(ctx context.Context, number rpc.BlockNumber) (*types.Header, <span class="type">error</span>)</span><br><span class="line">	HeaderByHash(ctx context.Context, hash common.Hash) (*types.Header, <span class="type">error</span>)</span><br><span class="line">	HeaderByNumberOrHash(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash) (*types.Header, <span class="type">error</span>)</span><br><span class="line">	CurrentHeader() *types.Header</span><br><span class="line">	CurrentBlock() *types.Header</span><br><span class="line">	BlockByNumber(ctx context.Context, number rpc.BlockNumber) (*types.Block, <span class="type">error</span>)</span><br><span class="line">	BlockByHash(ctx context.Context, hash common.Hash) (*types.Block, <span class="type">error</span>)</span><br><span class="line">	BlockByNumberOrHash(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash) (*types.Block, <span class="type">error</span>)</span><br><span class="line">	StateAndHeaderByNumber(ctx context.Context, number rpc.BlockNumber) (*state.StateDB, *types.Header, <span class="type">error</span>)</span><br><span class="line">	StateAndHeaderByNumberOrHash(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash) (*state.StateDB, *types.Header, <span class="type">error</span>)</span><br><span class="line">	PendingBlockAndReceipts() (*types.Block, types.Receipts)</span><br><span class="line">	GetReceipts(ctx context.Context, hash common.Hash) (types.Receipts, <span class="type">error</span>)</span><br><span class="line">	GetTd(ctx context.Context, hash common.Hash) *big.Int</span><br><span class="line">	GetEVM(ctx context.Context, msg *core.Message, state *state.StateDB, header *types.Header, vmConfig *vm.Config, blockCtx *vm.BlockContext) (*vm.EVM, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">error</span>)</span><br><span class="line">	SubscribeChainEvent(ch <span class="keyword">chan</span>&lt;- core.ChainEvent) event.Subscription</span><br><span class="line">	SubscribeChainHeadEvent(ch <span class="keyword">chan</span>&lt;- core.ChainHeadEvent) event.Subscription</span><br><span class="line">	SubscribeChainSideEvent(ch <span class="keyword">chan</span>&lt;- core.ChainSideEvent) event.Subscription</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Transaction pool API</span></span><br><span class="line">	SendTx(ctx context.Context, signedTx *types.Transaction) <span class="type">error</span></span><br><span class="line">	GetTransaction(ctx context.Context, txHash common.Hash) (*types.Transaction, common.Hash, <span class="type">uint64</span>, <span class="type">uint64</span>, <span class="type">error</span>)</span><br><span class="line">	GetPoolTransactions() (types.Transactions, <span class="type">error</span>)</span><br><span class="line">	GetPoolTransaction(txHash common.Hash) *types.Transaction</span><br><span class="line">	GetPoolNonce(ctx context.Context, addr common.Address) (<span class="type">uint64</span>, <span class="type">error</span>)</span><br><span class="line">	Stats() (pending <span class="type">int</span>, queued <span class="type">int</span>)</span><br><span class="line">	TxPoolContent() (<span class="keyword">map</span>[common.Address][]*types.Transaction, <span class="keyword">map</span>[common.Address][]*types.Transaction)</span><br><span class="line">	TxPoolContentFrom(addr common.Address) ([]*types.Transaction, []*types.Transaction)</span><br><span class="line">	SubscribeNewTxsEvent(<span class="keyword">chan</span>&lt;- core.NewTxsEvent) event.Subscription</span><br><span class="line"></span><br><span class="line">	ChainConfig() *params.ChainConfig</span><br><span class="line">	Engine() consensus.Engine</span><br><span class="line"></span><br><span class="line">	<span class="comment">// This is copied from filters.Backend</span></span><br><span class="line">	<span class="comment">// eth/filters needs to be initialized from this backend type, so methods needed by</span></span><br><span class="line">	<span class="comment">// it must also be included here.</span></span><br><span class="line">	GetBody(ctx context.Context, hash common.Hash, number rpc.BlockNumber) (*types.Body, <span class="type">error</span>)</span><br><span class="line">	GetLogs(ctx context.Context, blockHash common.Hash, number <span class="type">uint64</span>) ([][]*types.Log, <span class="type">error</span>)</span><br><span class="line">	SubscribeRemovedLogsEvent(ch <span class="keyword">chan</span>&lt;- core.RemovedLogsEvent) event.Subscription</span><br><span class="line">	SubscribeLogsEvent(ch <span class="keyword">chan</span>&lt;- []*types.Log) event.Subscription</span><br><span class="line">	SubscribePendingLogsEvent(ch <span class="keyword">chan</span>&lt;- []*types.Log) event.Subscription</span><br><span class="line">	BloomStatus() (<span class="type">uint64</span>, <span class="type">uint64</span>)</span><br><span class="line">	ServiceFilter(ctx context.Context, session *bloombits.MatcherSession)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For instance, the <code>SyncProgress()</code> method captures the node’s status as it synchronizes with the Ethereum network.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SyncProgress <span class="keyword">struct</span> &#123;</span><br><span class="line">	StartingBlock <span class="type">uint64</span> <span class="comment">// Block number where sync began</span></span><br><span class="line">	CurrentBlock  <span class="type">uint64</span> <span class="comment">// Current block number where sync is at</span></span><br><span class="line">	HighestBlock  <span class="type">uint64</span> <span class="comment">// Highest alleged block number in the chain</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// &quot;fast sync&quot; fields. These used to be sent by geth, but are no longer used</span></span><br><span class="line">	<span class="comment">// since version v1.10.</span></span><br><span class="line">	PulledStates <span class="type">uint64</span> <span class="comment">// Number of state trie entries already downloaded</span></span><br><span class="line">	KnownStates  <span class="type">uint64</span> <span class="comment">// Total number of state trie entries known about</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// &quot;snap sync&quot; fields.</span></span><br><span class="line">	SyncedAccounts      <span class="type">uint64</span> <span class="comment">// Number of accounts downloaded</span></span><br><span class="line">	SyncedAccountBytes  <span class="type">uint64</span> <span class="comment">// Number of account trie bytes persisted to disk</span></span><br><span class="line">	SyncedBytecodes     <span class="type">uint64</span> <span class="comment">// Number of bytecodes downloaded</span></span><br><span class="line">	SyncedBytecodeBytes <span class="type">uint64</span> <span class="comment">// Number of bytecode bytes downloaded</span></span><br><span class="line">	SyncedStorage       <span class="type">uint64</span> <span class="comment">// Number of storage slots downloaded</span></span><br><span class="line">	SyncedStorageBytes  <span class="type">uint64</span> <span class="comment">// Number of storage trie bytes persisted to disk</span></span><br><span class="line"></span><br><span class="line">	HealedTrienodes     <span class="type">uint64</span> <span class="comment">// Number of state trie nodes downloaded</span></span><br><span class="line">	HealedTrienodeBytes <span class="type">uint64</span> <span class="comment">// Number of state trie bytes persisted to disk</span></span><br><span class="line">	HealedBytecodes     <span class="type">uint64</span> <span class="comment">// Number of bytecodes downloaded</span></span><br><span class="line">	HealedBytecodeBytes <span class="type">uint64</span> <span class="comment">// Number of bytecodes persisted to disk</span></span><br><span class="line"></span><br><span class="line">	HealingTrienodes <span class="type">uint64</span> <span class="comment">// Number of state trie nodes pending</span></span><br><span class="line">	HealingBytecode  <span class="type">uint64</span> <span class="comment">// Number of bytecodes pending</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Regarding the protocol stack, it’s represented by the <code>Node</code> structure, which comprises numerous fields. Among these, the <code>stop</code> field plays a pivotal role as it signals the termination of the server.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node is a container on which services can be registered.</span></span><br><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">	eventmux      *event.TypeMux</span><br><span class="line">	config        *Config</span><br><span class="line">	accman        *accounts.Manager</span><br><span class="line">	log           log.Logger</span><br><span class="line">	keyDir        <span class="type">string</span>        <span class="comment">// key store directory</span></span><br><span class="line">	keyDirTemp    <span class="type">bool</span>          <span class="comment">// If true, key directory will be removed by Stop</span></span><br><span class="line">	dirLock       *flock.Flock  <span class="comment">// prevents concurrent use of instance directory</span></span><br><span class="line">	stop          <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125; <span class="comment">// Channel to wait for termination notifications</span></span><br><span class="line">	server        *p2p.Server   <span class="comment">// Currently running P2P networking layer</span></span><br><span class="line">	startStopLock sync.Mutex    <span class="comment">// Start/Stop are protected by an additional lock</span></span><br><span class="line">	state         <span class="type">int</span>           <span class="comment">// Tracks state of node lifecycle</span></span><br><span class="line"></span><br><span class="line">	lock          sync.Mutex</span><br><span class="line">	lifecycles    []Lifecycle <span class="comment">// All registered backends, services, and auxiliary services that have a lifecycle</span></span><br><span class="line">	rpcAPIs       []rpc.API   <span class="comment">// List of APIs currently provided by the node</span></span><br><span class="line">	http          *httpServer <span class="comment">//</span></span><br><span class="line">	ws            *httpServer <span class="comment">//</span></span><br><span class="line">	httpAuth      *httpServer <span class="comment">//</span></span><br><span class="line">	wsAuth        *httpServer <span class="comment">//</span></span><br><span class="line">	ipc           *ipcServer  <span class="comment">// Stores information about the ipc http server</span></span><br><span class="line">	inprocHandler *rpc.Server <span class="comment">// In-process RPC request handler to process the API requests</span></span><br><span class="line"></span><br><span class="line">	databases <span class="keyword">map</span>[*closeTrackingDB]<span class="keyword">struct</span>&#123;&#125; <span class="comment">// All open databases</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Once all configurations are in place and prior to the server’s actual launch, you should observe the following output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">INFO [09-13|12:46:39.391] Starting Geth on Ethereum mainnet...</span><br><span class="line">INFO [09-13|12:46:39.392] Bumping default cache on mainnet         provided=1024 updated=4096</span><br><span class="line">INFO [09-13|12:46:39.396] Maximum peer count                       ETH=50 LES=0 total=50</span><br><span class="line">INFO [09-13|12:46:39.400] Smartcard socket not found, disabling    err=&quot;stat /run/pcscd/pcscd.comm: no such file or directory&quot;</span><br><span class="line">INFO [09-13|12:46:39.408] Set global gas cap                       cap=50,000,000</span><br><span class="line">INFO [09-13|12:46:39.408] Initializing the KZG library             backend=gokzg</span><br><span class="line">INFO [09-13|12:46:39.611] Allocated trie memory caches             clean=614.00MiB dirty=1024.00MiB</span><br><span class="line">INFO [09-13|12:46:39.611] Using pebble as the backing database</span><br><span class="line">INFO [09-13|12:46:39.611] Allocated cache and file handles         database=/home/username/.ethereum/geth/chaindata cache=2.00GiB handles=32767</span><br><span class="line">INFO [09-13|12:46:39.677] Opened ancient database                  database=/home/username/.ethereum/geth/chaindata/ancient/chain readonly=false</span><br><span class="line">INFO [09-13|12:46:39.681] Initialising Ethereum protocol           network=1 dbversion=8</span><br><span class="line">INFO [09-13|12:46:39.681]</span><br><span class="line">INFO [09-13|12:46:39.681] ---------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">INFO [09-13|12:46:39.683] Chain ID:  1 (mainnet)</span><br><span class="line">INFO [09-13|12:46:39.683] Consensus: Beacon (proof-of-stake), merged from Ethash (proof-of-work)</span><br><span class="line">INFO [09-13|12:46:39.683]</span><br><span class="line">INFO [09-13|12:46:39.683] Pre-Merge hard forks (block based):</span><br><span class="line">INFO [09-13|12:46:39.683]  - Homestead:                   #1150000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/homestead.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - DAO Fork:                    #1920000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/dao-fork.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Tangerine Whistle (EIP 150): #2463000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/tangerine-whistle.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Spurious Dragon/1 (EIP 155): #2675000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/spurious-dragon.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Spurious Dragon/2 (EIP 158): #2675000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/spurious-dragon.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Byzantium:                   #4370000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/byzantium.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Constantinople:              #7280000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/constantinople.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Petersburg:                  #7280000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/petersburg.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Istanbul:                    #9069000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/istanbul.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Muir Glacier:                #9200000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/muir-glacier.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Berlin:                      #12244000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - London:                      #12965000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/london.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Arrow Glacier:               #13773000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/arrow-glacier.md)</span><br><span class="line">INFO [09-13|12:46:39.683]  - Gray Glacier:                #15050000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/gray-glacier.md)</span><br><span class="line">INFO [09-13|12:46:39.683]</span><br><span class="line">INFO [09-13|12:46:39.683] Merge configurationd:</span><br><span class="line">INFO [09-13|12:46:39.683]  - Hard-fork specification:    https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/paris.md</span><br><span class="line">INFO [09-13|12:46:39.683]  - Network known to be merged: true</span><br><span class="line">INFO [09-13|12:46:39.683]  - Total terminal difficulty:  58750000000000000000000</span><br><span class="line">INFO [09-13|12:46:39.683]</span><br><span class="line">INFO [09-13|12:46:39.683] Post-Merge hard forks (timestamp based):</span><br><span class="line">INFO [09-13|12:46:39.684]  - Shanghai:                    @1681338455 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/shanghai.md)</span><br><span class="line">INFO [09-13|12:46:39.684]</span><br><span class="line">INFO [09-13|12:46:39.684] ---------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">INFO [09-13|12:46:39.684]</span><br><span class="line">INFO [09-13|12:46:39.686] Loaded most recent local block           number=0 hash=d4e567..cb8fa3 td=17,179,869,184 age=54y5mo3w</span><br><span class="line">WARN [09-13|12:46:39.688] Loaded snapshot journal                  diffs=missing</span><br><span class="line">INFO [09-13|12:46:39.688] Resuming state snapshot generation       root=d7f897..0f0544 accounts=0 slots=0 storage=0.00B dangling=0 elapsed=&quot;34.181µs&quot;</span><br><span class="line">INFO [09-13|12:46:39.688] Loaded local transaction journal         transactions=0 dropped=0</span><br><span class="line">INFO [09-13|12:46:39.689] Regenerated local transaction journal    transactions=0 accounts=0</span><br><span class="line">INFO [09-13|12:46:39.729] Chain post-merge, sync via beacon client</span><br><span class="line">INFO [09-13|12:46:39.730] Gasprice oracle is ignoring threshold set threshold=2</span><br><span class="line">WARN [09-13|12:46:39.738] Unclean shutdown detected                booted=2023-09-12T15:07:35+0000 age=21h39m4s</span><br><span class="line">WARN [09-13|12:46:39.738] Unclean shutdown detected                booted=2023-09-13T08:02:05+0000 age=4h44m34s</span><br><span class="line">WARN [09-13|12:46:39.739] Engine API enabled                       protocol=eth</span><br></pre></td></tr></table></figure>
<p>Following this, the <code>startNode</code> function executes, paving the way for <code>StartNode</code>, which is responsible for actually initiating the server. The method <code>stack.Start()</code> found in <code>cmd/utils/cmd.go:72</code> will launch the node. Once the server is up and running, the Geth client keeps tabs on the disk space and monitors system signals to determine when to terminate the server.</p>
<p>Within the <code>Start()</code> method, the line <code>err := n.openEndpoints()</code> is responsible to open networking and RPC endpoint. Meanwhile, the <code>n.server.Start()</code> method, located at <code>node/node.go:269</code> initiates the p2p discovery and handshake processes. Concurrently, the line <code>err := n.startRPC()</code> located at <code>node/node.go:273</code> brings the RPC endpoint to life. The output should resemble the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INFO [09-13|13:56:00.514] Starting peer-to-peer node               instance=Geth/v1.12.1-unstable-60ce4e8d-20230810/linux-amd64/go1.20.6</span><br><span class="line">INFO [09-13|13:56:04.989] New local node record                    seq=1,694,613,193,948 id=72f98ebcedb92640 ip=127.0.0.1 udp=35555 tcp=35555</span><br><span class="line">INFO [09-13|13:56:05.083] Started P2P networking                   self=enode://9fc6b61a19d99e8a78ae8f8dbd12f27d208ce9b01dd52177fbfee1812a37467b3c3bab49c181b26b240f52bf1ac8afe64915f9b89465a540a74fdcb5e37f2abd@127.0.0.1:35555</span><br><span class="line">INFO [09-13|13:56:05.325] Generating state snapshot                root=d7f897..0f0544 at=9a53a5..ad4ba5 accounts=5375 slots=0 storage=247.62KiB dangling=0 elapsed=8.003s     eta=28.97s</span><br><span class="line">INFO [09-13|13:56:10.187] IPC endpoint opened                      url=/home/username/.ethereum/geth.ipc</span><br><span class="line">INFO [09-13|13:56:10.200] Loaded JWT secret file                   path=/home/username/.ethereum/geth/jwtsecret crc32=0x3392b636</span><br><span class="line">INFO [09-13|13:56:11.116] WebSocket enabled                        url=ws://127.0.0.1:8553</span><br><span class="line">INFO [09-13|13:56:11.121] HTTP server started                      endpoint=127.0.0.1:8553 auth=true prefix= cors=localhost vhosts=localhost</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Once the p2p network layer has been executed successfully, the crucial Ethereum protocol initiates and remains active. Two essential components stand out:</p>
<ul>
<li><code>txPool</code>: This manages transactions according to a specified strategy.</li>
<li><code>blockchain</code>: This encompasses the EVM (Ethereum Virtual Machine) and upholds the chain structure of the blockchain.</li>
</ul>
<p>The rationale for defining the subprotocol as a slice of lifecycle is that Geth also supports other protocols layered over the Devp2p protocol.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ethereum implements the Ethereum full node service.</span></span><br><span class="line"><span class="keyword">type</span> Ethereum <span class="keyword">struct</span> &#123;</span><br><span class="line">	config *ethconfig.Config</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Handlers</span></span><br><span class="line">	txPool *txpool.TxPool</span><br><span class="line"></span><br><span class="line">	blockchain         *core.BlockChain</span><br><span class="line">	handler            *handler</span><br><span class="line">	ethDialCandidates  enode.Iterator</span><br><span class="line">	snapDialCandidates enode.Iterator</span><br><span class="line">	merger             *consensus.Merger</span><br><span class="line"></span><br><span class="line">	<span class="comment">// DB interfaces</span></span><br><span class="line">	chainDb ethdb.Database <span class="comment">// Block chain database</span></span><br><span class="line"></span><br><span class="line">	eventMux       *event.TypeMux</span><br><span class="line">	engine         consensus.Engine</span><br><span class="line">	accountManager *accounts.Manager</span><br><span class="line"></span><br><span class="line">	bloomRequests     <span class="keyword">chan</span> <span class="keyword">chan</span> *bloombits.Retrieval <span class="comment">// Channel receiving bloom data retrieval requests</span></span><br><span class="line">	bloomIndexer      *core.ChainIndexer             <span class="comment">// Bloom indexer operating during block imports</span></span><br><span class="line">	closeBloomHandler <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	APIBackend *EthAPIBackend</span><br><span class="line"></span><br><span class="line">	miner     *miner.Miner</span><br><span class="line">	gasPrice  *big.Int</span><br><span class="line">	etherbase common.Address</span><br><span class="line"></span><br><span class="line">	networkID     <span class="type">uint64</span></span><br><span class="line">	netRPCService *ethapi.NetAPI</span><br><span class="line"></span><br><span class="line">	p2pServer *p2p.Server</span><br><span class="line"></span><br><span class="line">	lock sync.RWMutex <span class="comment">// Protects the variadic fields (e.g. gas price and etherbase)</span></span><br><span class="line"></span><br><span class="line">	shutdownTracker *shutdowncheck.ShutdownTracker <span class="comment">// Tracks if and when the node has shutdown ungracefully</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To summarize, the steps for starting a Geth client are as follows:</p>
<ol>
<li><strong>Command Line Parsing</strong>: The parser breaks down flags, subcommands, or the configuration file into a <code>context</code>.</li>
<li><strong>Process Context</strong>: The command line context is processed, establishing memory cache allowances and, if enabled, metrics that monitor the runtime environment.</li>
<li><strong>Protocol Stack Assembly</strong>: Based on the provided configuration, the protocol stack is assembled into a node struct. Concurrently, interaction methods are incorporated into <code>ethapi.Backend</code>.</li>
<li>Node Initialization:
<ol>
<li><strong>P2P Network Layer</strong>: Initiates the p2p network layer for node discovery and facilitates basic pre-subprotocol (devp2p) message exchange.</li>
<li><strong>RPC Endpoint</strong>: This step starts the RPC endpoint.</li>
<li><strong>Subprotocols Activation</strong>: All the specified subprotocols in the lifecycles of the local node are initiated.</li>
<li><strong>Monitoring</strong>: Upon successful initialization, the system begins monitoring disk space and awaits system signals for termination.</li>
</ol>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://www.blog-blockchain.xyz">Michael(Jiahao) Luo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://www.blog-blockchain.xyz/geth/Geth-Unveiled-Ethereum-Startup/">https://www.blog-blockchain.xyz/geth/Geth-Unveiled-Ethereum-Startup/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/geth/">geth</a></div><div class="post-share"><div class="social-share" data-image="/images/geth.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/pl/fuzzing-introduction/" title="（十）Fuzzing 基础"><img class="cover" src="/images/pa.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">（十）Fuzzing 基础</div></div><div class="info-2"><div class="info-item-1"> （一）初识软件分析（二）数据流分析基础（三）Datalog和程序分析（四）静态单赋值和稀疏分析（五）过程间分析（六）指向分析（七）抽象解释（八）SMT和符号执行（九）体验静态分析工具（十）Fuzzing 基础   这主要是[1]的阅读总结  Fuzzing 是什么 在众多软件测试技术中，Fuzzing 因其概念的简单性、易于部署以及在发现实际软件漏洞方面的有效性而受到广泛青睐。简而言之，Fuzzing 是使用异常或非预期的输入（称为“fuzz 输入”）来运行待测试的程序（Program Under Test, PUT）的过程。这种 fuzz 输入是 PUT 可能没有预料到的，也就是说，它可能会使 PUT 处理不当，从而触发开发者未预期的行为。 定义 1 (Fuzzing)：Fuzzing 是指使用从所谓的“fuzz 输入空间”中抽取的输入来执行 PUT 的过程，这个输入空间超出了 PUT 的预期输入范围。 定义 2 (Fuzz Testing)：Fuzz 测试是利用 fuzzing 来检查 PUT 是否违反了某些特定的正确性策略。 定义 3 (Fuzzer)：Fuzzer...</div></div></div></a><a class="pagination-related" href="/audit/blockchian-study-material/" title="区块链相关学习材料"><img class="cover" src="/images/smart-contract-audit.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">区块链相关学习材料</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/geth/MPT-Tree/" title="MPT树"><img class="cover" src="/images/geth.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-25</div><div class="info-item-2">MPT树</div></div><div class="info-2"><div class="info-item-1"> 交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server   由于MPT 树不属于core部分所以有些地方并没有详细的解读，仅供参考。 由于该部分网上的解读都差异不大，故该文章大部分是进行整合，并且加上个人阅读源码的一些看法，所有图片都已经上传到个人仓库。 感谢前辈的精湛分析！   前缀树 Trie 前缀树（又称字典树），通常来说，一个前缀树是用来存储字符串的。前缀树的每一个节点代表一个字符串（前缀）。每一个节点会有多个子节点，通往不同子节点的路径上有着不同的字符。子节点代表的字符串是由节点本身的原始字符串，以及通往该子节点路径上所有的字符组成的。如下图所示：  Trie 的结点看上去是这样子的：  [ [Ia, Ib, … I*], value]  其中 [Ia, Ib, ... I*] 在本文中我们将其称为结点的 索引数组 ，它以 key...</div></div></div></a><a class="pagination-related" href="/geth/forkId/" title="forkId 解读"><img class="cover" src="/images/geth.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-25</div><div class="info-item-2">forkId 解读</div></div><div class="info-2"><div class="info-item-1"> 交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server  EIP-2124 因为 core/forkId 包是 EIP-2124 的实现，因此我们先了解 EIP-2124 的内容。 目的  记住以太坊是向后兼容！  以太坊节点之前寻找其他节点的方式是：随机的选择可以连接的节点，再去判断节点是否对自己有用。但是其他的节点可能是主网节点、测试网节点、私网节点、共识机制不一致的节点，这样“盲目”的寻找会浪费资源。 于是这个提案希望在连接前，其他节点可以发送自己的链配置，实现精确连接到有用节点。这个传递的信息在提案中被称作 fork identifier，它实现如下功能：  如果两个节点在不同的网络上，他们不应该考虑连接。 如果硬分叉通过，升级的节点应该拒绝未升级的节点。 如果两条链有相同的创世区块配置和链配置，但没有分叉（ETH /...</div></div></div></a><a class="pagination-related" href="/geth/block-sync/" title="区块同步"><img class="cover" src="/images/geth.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-25</div><div class="info-item-2">区块同步</div></div><div class="info-2"><div class="info-item-1"> 交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server   博主的朋友写的  看到core\blockchain.go的时候大量涉及该部分知识，故在此参考大佬博客加之自己的理解先行总结 本文仅仅是简单总结了一下文件结构和重要函数功能，详细函数分析请参考downloader 同步   文件结构 downloader 模块的代码位于 eth/downloader 目录下。主要的功能代码分别是：   downloader.go ：实现了区块同步逻辑   peer.go ：对区块各个阶段的组装，下面的各个FetchXXX 就是很依赖这个模块。   queue.go ：对eth/peer.go的封装   statesync.go ：同步state对象   注意：   downloader是一个下载器，从远程网络节点中获取 hashes 和...</div></div></div></a><a class="pagination-related" href="/geth/blockchain-core/" title="blockchain核心"><img class="cover" src="/images/geth.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-25</div><div class="info-item-2">blockchain核心</div></div><div class="info-2"><div class="info-item-1"> 交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server   参考： 以太坊 blockchain 源码分析 - mindcarver - 博客园 (cnblogs.com)   主要部分转载：以太坊 blockchain 源码分析  blockchain 关键元素  db：持久化到底层数据储存，即 leveldb（注意不是 MySQL）（源码core/rawdb）；(参考文章：)Leveldb 基本介绍和使用指南 - 知乎 (zhihu.com) 以及对应的百科 [LevelDB_百度百科 (baidu.com)](https://baike.baidu.com/item/LevelDB/6416354#:~:text= Leveldb 是一个 google 实现的非常高效的 kv 数据库，目前的版本 1.2 能够支持 billion 级别的数据量了。...</div></div></div></a><a class="pagination-related" href="/geth/bloom-filter/" title="布隆过滤器原理"><img class="cover" src="/images/geth.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-25</div><div class="info-item-2">布隆过滤器原理</div></div><div class="info-2"><div class="info-item-1"> 交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server  介绍  布隆过滤器（英语：Bloom Filter）是 1970 年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难。  可见，它解决的核心问题是 检索一个元素是否在一个集合中。原理大致如下： 当一个元素被加入集合时，通过 K 个散列函数将这个元素映射成一个二进制数组中的 K 个位置，把这些位置的值设置为 1。检索时，我们只要观察这些对应的位置的值是不是都是 1 就（大约）知道集合中有没有检索的元素：如果这 K 个位置中有任何一个 0，则被检索元素一定不在集合中；如果都是...</div></div></div></a><a class="pagination-related" href="/geth/blocks/" title="理解区块"><img class="cover" src="/images/geth.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-25</div><div class="info-item-2">理解区块</div></div><div class="info-2"><div class="info-item-1"> 交易的签名理解收据receipt理解区块理解交易blockchain核心forkId 解读布隆过滤器原理交易池分析oracle 原理和实现TxList 解读MPT树区块同步geth源码学习——介绍How Geth starts its server  结构定义 区块  首先我们需要明白区块的结构。 123456789101112131415161718192021// Block represents an entire block in the Ethereum blockchain.type Block struct &#123;   header       *Header      //区块头   uncles       []*Header    //引用的叔块   transactions Transactions //交易   // caches   hash atomic.Value //区块哈希   size atomic.Value //区块大小   // Td is used by package core to store the total...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/site-avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Michael(Jiahao) Luo</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">84</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/LearnerLj"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://www.linkedin.com/in/jiahao-michael-luo-8ba5942a3" rel="external nofollow noreferrer" target="_blank" title="Linkedin"><i class="fa-brands fa-linkedin"></i></a><a class="social-icon" href="https://x.com/jiahao_luo9" rel="external nofollow noreferrer" target="_blank" title="Twitter"><i class="fa-brands fa-twitter"></i></a><a class="social-icon" href="https://github.com/learnerLj" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:luoshitou9@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS链接"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">从技术到商业，从产品到设计，从生活到未来，我会在这里分享我的所思所想，欢迎关注！</div></div><div class="sticky_layout"><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>Post Series</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/geth/tx-signature/" title="交易的签名"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="交易的签名"></a><div class="content"><a class="title" href="/geth/tx-signature/" title="交易的签名">交易的签名</a><time datetime="2022-08-24T17:30:33.000Z" title="Created 2022-08-25 01:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/understand-receipt/" title="理解收据receipt"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="理解收据receipt"></a><div class="content"><a class="title" href="/geth/understand-receipt/" title="理解收据receipt">理解收据receipt</a><time datetime="2022-08-24T21:30:33.000Z" title="Created 2022-08-25 05:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/blocks/" title="理解区块"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="理解区块"></a><div class="content"><a class="title" href="/geth/blocks/" title="理解区块">理解区块</a><time datetime="2022-08-25T00:30:33.000Z" title="Created 2022-08-25 08:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/understand-tx/" title="理解交易"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="理解交易"></a><div class="content"><a class="title" href="/geth/understand-tx/" title="理解交易">理解交易</a><time datetime="2022-08-25T01:30:33.000Z" title="Created 2022-08-25 09:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/blockchain-core/" title="blockchain核心"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="blockchain核心"></a><div class="content"><a class="title" href="/geth/blockchain-core/" title="blockchain核心">blockchain核心</a><time datetime="2022-08-25T02:30:33.000Z" title="Created 2022-08-25 10:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/forkId/" title="forkId 解读"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="forkId 解读"></a><div class="content"><a class="title" href="/geth/forkId/" title="forkId 解读">forkId 解读</a><time datetime="2022-08-25T03:30:33.000Z" title="Created 2022-08-25 11:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/bloom-filter/" title="布隆过滤器原理"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="布隆过滤器原理"></a><div class="content"><a class="title" href="/geth/bloom-filter/" title="布隆过滤器原理">布隆过滤器原理</a><time datetime="2022-08-25T03:30:33.000Z" title="Created 2022-08-25 11:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/tx-pool/" title="交易池分析"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="交易池分析"></a><div class="content"><a class="title" href="/geth/tx-pool/" title="交易池分析">交易池分析</a><time datetime="2022-08-25T03:30:33.000Z" title="Created 2022-08-25 11:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/oracle-introduction/" title="oracle 原理和实现"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="oracle 原理和实现"></a><div class="content"><a class="title" href="/geth/oracle-introduction/" title="oracle 原理和实现">oracle 原理和实现</a><time datetime="2022-08-25T03:30:33.000Z" title="Created 2022-08-25 11:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/txlist/" title="TxList 解读"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TxList 解读"></a><div class="content"><a class="title" href="/geth/txlist/" title="TxList 解读">TxList 解读</a><time datetime="2022-08-25T03:30:33.000Z" title="Created 2022-08-25 11:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/MPT-Tree/" title="MPT树"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MPT树"></a><div class="content"><a class="title" href="/geth/MPT-Tree/" title="MPT树">MPT树</a><time datetime="2022-08-25T04:30:33.000Z" title="Created 2022-08-25 12:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/block-sync/" title="区块同步"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="区块同步"></a><div class="content"><a class="title" href="/geth/block-sync/" title="区块同步">区块同步</a><time datetime="2022-08-25T08:30:33.000Z" title="Created 2022-08-25 16:30:33">2022-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/introduction/" title="geth源码学习——介绍"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="geth源码学习——介绍"></a><div class="content"><a class="title" href="/geth/introduction/" title="geth源码学习——介绍">geth源码学习——介绍</a><time datetime="2022-09-28T08:30:33.000Z" title="Created 2022-09-28 16:30:33">2022-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/geth/Geth-Unveiled-Ethereum-Startup/" title="How Geth starts its server"><img src="/images/geth.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="How Geth starts its server"></a><div class="content"><a class="title" href="/geth/Geth-Unveiled-Ethereum-Startup/" title="How Geth starts its server">How Geth starts its server</a><time datetime="2023-09-13T15:02:10.000Z" title="Created 2023-09-13 23:02:10">2023-09-13</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/solana/solana-basic/" title="Solana 合约开发基础"><img src="https://cdn.blog-blockchain.xyz/2025/05/a8ff2c0938675dd107393164903785c8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Solana 合约开发基础"/></a><div class="content"><a class="title" href="/solana/solana-basic/" title="Solana 合约开发基础">Solana 合约开发基础</a><time datetime="2025-05-18T14:58:33.000Z" title="Created 2025-05-18 22:58:33">2025-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/solana/solana-flashloan-1/" title="Solana flashloan 原理和设计"><img src="https://cdn.blog-blockchain.xyz/2025/05/a8ff2c0938675dd107393164903785c8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Solana flashloan 原理和设计"/></a><div class="content"><a class="title" href="/solana/solana-flashloan-1/" title="Solana flashloan 原理和设计">Solana flashloan 原理和设计</a><time datetime="2025-05-17T14:09:33.000Z" title="Created 2025-05-17 22:09:33">2025-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/career/pursuit-of-meaning-and-freedom/" title="在追寻意义中找寻自由：现代社会中的生存哲学"><img src="https://cdn.blog-blockchain.xyz/2025/05/2f8d359c909d472a620007158cbcaaf4.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在追寻意义中找寻自由：现代社会中的生存哲学"/></a><div class="content"><a class="title" href="/career/pursuit-of-meaning-and-freedom/" title="在追寻意义中找寻自由：现代社会中的生存哲学">在追寻意义中找寻自由：现代社会中的生存哲学</a><time datetime="2025-05-01T04:11:20.000Z" title="Created 2025-05-01 12:11:20">2025-05-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/career/Career-and-Life-Between-Ideal-and-Reality/" title="我对职场和人生的思考：在理想与现实之间"><img src="https://cdn.blog-blockchain.xyz/2025/04/4f93c7d9a0c3628ac37db9606c1dca24.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="我对职场和人生的思考：在理想与现实之间"/></a><div class="content"><a class="title" href="/career/Career-and-Life-Between-Ideal-and-Reality/" title="我对职场和人生的思考：在理想与现实之间">我对职场和人生的思考：在理想与现实之间</a><time datetime="2025-04-20T19:22:20.000Z" title="Created 2025-04-21 03:22:20">2025-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/dev/rust-lifetime/" title="深入学习Rust生命周期"><img src="https://cdn.blog-blockchain.xyz/2025/03/7a1eb877711a4e78b90307ccefde92f4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入学习Rust生命周期"/></a><div class="content"><a class="title" href="/dev/rust-lifetime/" title="深入学习Rust生命周期">深入学习Rust生命周期</a><time datetime="2025-03-28T10:58:20.000Z" title="Created 2025-03-28 18:58:20">2025-03-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Michael(Jiahao) Luo</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.3.5"></script><script src="/js/main.js?v=5.3.5"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css')
    if (false) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: '467d9506710fff22dc33',
      clientSecret: '2a3e530b895af9c94d4bbe95fe78c69317f4d76e',
      repo: 'blog-gitalk',
      owner: 'learnerLj',
      admin: ['learnerLj'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || 'b2de07a520fd16051481bcc4b8bbaaec'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.3.5"></script></div></div></body></html>